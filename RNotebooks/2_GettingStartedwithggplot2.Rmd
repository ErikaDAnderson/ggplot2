---
title: "ggplot2: 2 First Steps"
output: html_notebook
---

This notebook is based on exercises completed from [ggplot2: Elegant Graphics for Data Analysis](https://ggplot2-book.org/index.html). 

```{r setup, warning=FALSE,message=FALSE}
library(tidyverse)
#library(ggplot2)

# set global theme for graphs
theme_set(theme_bw())

```


## 2.2.1 Fuel Economy Data

1.List five functions that you could use to get more information about the mpg data set.

```{r}
summary(mpg)
length(mpg)
str(mpg)
head(mpg)
tail(mpg)
names(mpg)
nrow(mpg)
class(mpg)
glimpse(mpg)

# opens data in RStudio, but not visible in R notebook
#View(mpg)

```


2.How can you find out what other data sets are included with ggplot2?

```{r}
data(package = "ggplot2")
# opens window in RStudio and lists the associated data
```

Data sets in package ‘ggplot2’:

diamonds                     Prices of over 50,000 round cut diamonds  
economics                    US economic time series  
economics_long               US economic time series  
faithfuld                    2d density estimate of Old Faithful data  
luv_colours                  'colors()' in Luv space  
midwest                      Midwest demographics  
mpg                          Fuel economy data from 1999 to 2008 for 38 popular models
                             of cars  
msleep                       An updated and expanded version of the mammals sleep
                             dataset  
presidential                 Terms of 11 presidents from Eisenhower to Obama  
seals                        Vector field of seal movements  
txhousing                    Housing sales in TX  


3.Apart from the US, most countries use fuel consumption (fuel consumed over fixed distance) rather than fuel economy (distance travelled with fixed amount of fuel). How could you convert cty and hwy into the European standard of l/100km?

Conversion values from [this website](https://www.asknumbers.com/mpg-to-L100km.aspx#:~:text=To%20convert%20mpg%20to%20liters,9.8%20liters%20per%20100%20km)  

```{r}

mpg %>%
  mutate(cty_metric = round(235.214/cty,0),
         hwy_metric = round(235.214/hwy,0)) %>%
  select(cty, cty_metric, hwy, hwy_metric)  

mpg %>%
    mutate(ecty = (3.78541*100)/(1.609344*cty)) %>%
    mutate(ehwy = (3.78541*100)/(1.609344*hwy)) %>%
    select(cty, ecty, hwy, ehwy) 

mpg %>%
 mutate(
 cty_euro = 235.214583/cty,
 hwy_euro = 235.214583/hwy
 ) %>%
  select(cty, cty_euro, hwy, hwy_euro)

```


4.Which manufacturer has the most models in this dataset? Which model has the most variations? Does your answer change if you remove the redundant specification of drive train (e.g. “pathfinder 4wd”, “a4 quattro”) from the model name?

Dodge has the most models in the original data set.  
The model with the most variation is caravan 2wd.  
If we remove the drive train from the model, Toyota is the manufacturer with the most models.  

```{r}
# most models by manufacturer
mpg %>%
  group_by(manufacturer) %>%
  count() %>%
  arrange(-n)

# JN version assuming year not unique to model 
mpg %>%
 count(manufacturer, sort = T)

mpg %>%
 group_by(manufacturer) %>%
 summarise(num.models = length(unique(model))) %>%
 arrange(desc(num.models))

# ST version
mpg %>%
 group_by(manufacturer) %>%
 summarise(n_distinct(model))

# CG version
mpg %>% 
  group_by(model) %>% 
  tally()

# most variation in a model defined as the most entries per one model
mpg %>%
  group_by(model) %>%
  count() %>%
  arrange(-n)

# BH version in base R
with(mpg,tapply(model,model,length))

# remove redundant specification in model name, then recount models per manufacturer
mpg %>%
  mutate(model_simple = str_replace_all(model, c("quattro" = "", "4wd" = "",
                                              "2wd" = "", "awd" = ""))) %>%
  distinct(manufacturer, model_simple, year) %>%
  group_by(manufacturer) %>%
  count() %>%
  arrange(-n)

mpg %>%
  mutate(model_simple = str_replace_all(model, c("quattro" = "", "4wd" = "",
                                              "2wd" = "", "awd" = ""))) %>%
  distinct(manufacturer, model_simple) %>%
  group_by(manufacturer) %>%
  count() %>%
  arrange(-n)

# JN version
#to get rid of drive train complication
 sort(unique(mpg$model)) #looks like first 2 letters should be enough to split

 mpg %>%
   transform(model, base = substr(model, 1, 2)) %>%
   group_by(manufacturer) %>%
   summarise(num.models = length(unique(base))) %>%
   arrange(desc(num.models))
 
 list(unique(mpg$model[mpg$manufacturer=="audi"])) #the above method took audi from 3 ->2, seems to work
 
 list(unique(mpg$model[mpg$manufacturer=="toyota"])) #the above method took audi from 6 ->5, seems to work
 
 list(unique(mpg$model[mpg$manufacturer=="dodge"])) #the above method didn't affect Dodge, seems to work
 
```

### 2.3 Key Components

1. How would you describe the relationship between cty and hwy? Do you have any concerns about drawing conclusions from that plot?

As fuel economy goes up in city driving, it also goes up for highway driving. Positive, linear relationship. Concerns?

```{r}

ggplot(mpg, aes(cty, hwy)) +
  geom_point()

```


2. What does ggplot(mpg, aes(model, manufacturer)) + geom_point() show? Is it useful? How could you modify the data to make it more informative?

Each model only belongs to one manufacturer so not really useful. Perhaps count models by manufacturer?

```{r}

ggplot(mpg, aes(model, manufacturer)) + 
    geom_point() +
  # added so I could read text on x-axis
    theme(axis.text.x = element_text(angle = 90))

ggplot(mpg, aes(manufacturer)) + 
    geom_bar() +
    theme(axis.text.x = element_text(angle = 90))

```


3. Describe the data, aesthetic mappings and layers used for each of the following plots. You’ll need to guess a little because you haven’t seen all the datasets and functions yet, but use your common sense! See if you can predict what the plot will look like before running the code.

```{r}

ggplot(mpg, aes(cty, hwy)) + 
  geom_point()

ggplot(diamonds, aes(carat, price)) +
  geom_point()

ggplot(economics, aes(date, unemploy)) + 
  geom_line()

```

## 2.4.1 Colour, size, shape and other aesthetic attributes

1. Experiment with the colour, shape and size aesthetics. What happens when you map them to continuous values? What about categorical values? What happens when you use more than one aesthetic in a plot?

2. What happens if you map a continuous variable to shape? Why? What happens if you map trans to shape? Why?

3. How is drive train related to fuel economy? How is drive train related to engine size and class?

## 2.5.1 Facetting

1. What happens if you try to facet by a continuous variable like hwy? What about cyl? What’s the key difference?

2. Use facetting to explore the 3-way relationship between fuel economy, engine size, and number of cylinders. How does facetting by number of cylinders change your assessement of the relationship between engine size and fuel economy?

3. Read the documentation for facet_wrap(). What arguments can you use to control how many rows and columns appear in the output?

4. What does the scales argument to facet_wrap() do? When might you use it?

## 2.6.6 Plot Geoms

1. What’s the problem with the plot created by ggplot(mpg, aes(cty, hwy)) + geom_point()? Which of the geoms described above is most effective at remedying the problem?

2. One challenge with ggplot(mpg, aes(class, hwy)) + geom_boxplot() is that the ordering of class is alphabetical, which is not terribly useful. How could you change the factor levels to be more informative?

  Rather than reordering the factor by hand, you can do it automatically based on the data: ggplot(mpg, aes(reorder(class, hwy), hwy)) + geom_boxplot(). What does reorder() do? Read the documentation.

3. Explore the distribution of the carat variable in the diamonds dataset. What binwidth reveals the most interesting patterns?

4. Explore the distribution of the price variable in the diamonds data. How does the distribution vary by cut?

5. You now know (at least) three ways to compare the distributions of subgroups: geom_violin(), geom_freqpoly() and the colour aesthetic, or geom_histogram() and facetting. What are the strengths and weaknesses of each approach? What other approaches could you try?

6. Read the documentation for geom_bar(). What does the weight aesthetic do?

7. Using the techniques already discussed in this chapter, come up with three ways to visualise a 2d categorical distribution. Try them out by visualising the distribution of model and manufacturer, trans and class, and cyl and trans.
  
